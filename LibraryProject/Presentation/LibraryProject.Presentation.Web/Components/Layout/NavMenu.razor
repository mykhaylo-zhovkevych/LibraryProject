@using Microsoft.AspNetCore.Authorization
@using LibraryProject.Application.Interfaces
@using Microsoft.AspNetCore.Antiforgery

@inject ICurrentUserContext CurrentUser
@inject IHttpContextAccessor HttpContextAccessor
@inject IAntiforgery Antiforgery

<nav class="topnav" id="topnav">
    <AuthorizeView>
        <Authorized>
            <div class="topnav__row topnav__row--primary">

                <div class="topnav__left">
                    <span class="topnav__brand">
                        Bibliothek
                    </span>
                </div>

                <div class="topnav__right">
                    <form method="post"
                          action="/auth/logout"
                          class="topnav__logout-form">
                        <input type="hidden"
                               name="__RequestVerificationToken"
                               value="@AntiForgeryToken" />

                        <button type="submit"
                                class="topnav__button topnav__button--logout">
                            Logout
                        </button>
                    </form>
                </div>
            </div>

            <div class="topnav__row topnav__row--links">
                <NavLink class="topnav__link" href="/" Match="NavLinkMatch.All">Katalog</NavLink>
                <NavLink class="topnav__link" href="/profile">Profil</NavLink>
                <NavLink class="topnav__link" href="/overview">Übersicht</NavLink>
            </div>
        </Authorized>

        <NotAuthorized>
            <div class="topnav__row topnav__row--primary">
                <span class="topnav__brand">
                    Bibliothek
                </span>
            </div>
        </NotAuthorized>
    </AuthorizeView>
</nav>

@code {
    private string AntiForgeryToken = "";

    protected override void OnInitialized()
    {
        HttpContext? http = HttpContextAccessor.HttpContext;
        if (http is not null)
        {
            AntiForgeryToken = Antiforgery.GetAndStoreTokens(http).RequestToken ?? "";
        }
    }
}